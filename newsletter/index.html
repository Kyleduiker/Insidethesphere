<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newsletter Builder Pro - Inside the Sphere</title>
    
    <!-- Your existing website CSS (parent directory) -->
    <link rel="stylesheet" href="../navigation.css">
    <link rel="stylesheet" href="../main.css">
    
    <!-- Newsletter isolated CSS (same directory) -->
    <link rel="stylesheet" href="newsletter-isolated.css">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;500;600&family=Crimson+Text:wght@400;600&family=Raleway:wght@300;400;500&family=Lora:wght@400;500&family=Cormorant+Garamond:wght@300;400;500&display=swap" rel="stylesheet">
</head>
<body class="has-sphere-nav">
    <!-- Your website navigation will load here automatically -->
    
    <!-- Newsletter Builder Container (ISOLATED) -->
    <div class="newsletter-builder-wrapper">
        <!-- Toast Container -->
        <div class="toast-container" id="toastContainer"></div>

        <!-- Export Modal -->
        <div class="newsletter-modal-overlay" id="exportModal">
            <div class="newsletter-modal">
                <h3 style="margin-bottom: 20px; font-size: 20px; color: var(--primary-color);">üìß Export Newsletter</h3>
                
                <div class="compatibility-warning">
                    <h4>‚úÖ Email Client Compatibility</h4>
                    <ul style="margin: 10px 0; font-size: 13px; line-height: 1.4;">
                        <li>All images are automatically uploaded to Imgur for perfect email compatibility</li>
                        <li>Newsletter uses hosted image URLs - works in all email clients</li>
                        <li>No blocked images or deliverability issues</li>
                        <li>Always test in your target email clients before sending</li>
                        <li>Professional hosting ensures images load reliably</li>
                    </ul>
                </div>
                
                <div class="compatibility-info">
                    <h4>üìä Email Client Support</h4>
                    <div>
                        ‚úÖ <strong>Gmail:</strong> Excellent support<br>
                        ‚úÖ <strong>Apple Mail:</strong> Best support
                    </div>
                </div>

                <div class="compatibility-info">
                    <h4>üñ®Ô∏è Print Optimization</h4>
                    <div>
                        <strong>Print Version:</strong> Optimized for standard letter paper (8.5" x 11")<br>
                        <strong>Features:</strong> Proper margins, page breaks, black & white friendly<br>
                        <strong>Best For:</strong> Client handouts, office distribution, archival copies
                    </div>
                </div>
                
                <div style="display: grid; gap: 10px; margin-top: 20px;">
                    <button class="btn btn--primary" onclick="exportManager.copyEmailSafeHTML()">
                        üìß Copy Newsletter for email
                    </button>
                    <button class="btn btn--success" onclick="exportManager.exportAsHTML()">
                        üìÑ Download HTML File (Hosted URLs)
                    </button>
                    <button class="btn btn--info" onclick="exportManager.printNewsletter()">
                        üñ®Ô∏è Print Newsletter
                    </button>
                    <button class="btn btn--secondary" onclick="modalManager.close('exportModal')">
                        Cancel
                    </button>
                </div>
            </div>
        </div>

        <!-- Add Event Modal -->
        <div class="newsletter-modal-overlay" id="addEventModal">
            <div class="newsletter-modal">
                <h3 style="margin-bottom: 20px; color: var(--primary-color);">Add Event</h3>
                <form id="addEventForm">
                    <div class="form-group">
                        <label class="form-group__label required-field">Event Title</label>
                        <input type="text" class="form-group__input" id="eventTitle" required>
                        <div class="validation-message" id="eventTitle-validation"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-group__label required-field">Date</label>
                            <input type="date" class="form-group__input" id="eventDate" required>
                            <div class="validation-message" id="eventDate-validation"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-group__label">Start Time</label>
                            <input type="time" class="form-group__input" id="eventStartTime">
                            <div class="validation-message" id="eventStartTime-validation"></div>
                            <small>Optional - leave blank for all-day events</small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-group__label">End Time</label>
                        <input type="time" class="form-group__input" id="eventEndTime">
                        <div class="validation-message" id="eventEndTime-validation"></div>
                        <small>Optional - leave blank if no specific end time</small>
                    </div>
                    <div class="form-group">
                        <label class="form-group__label">Location</label>
                        <input type="text" class="form-group__input" id="eventLocation">
                        <div class="validation-message" id="eventLocation-validation"></div>
                        <small>Optional - leave blank for online events or TBA</small>
                    </div>
                    <div class="form-group">
                        <label class="form-group__label">Description (Optional)</label>
                        <textarea class="form-group__textarea" id="eventDescription" rows="3"></textarea>
                        <div class="validation-message" id="eventDescription-validation"></div>
                    </div>
                    <div class="form-group">
                        <label class="form-group__label">Event Details Link (Optional)</label>
                        <input type="url" class="form-group__input" id="eventDetailsLink" placeholder="https://example.com/event-details">
                        <div class="validation-message" id="eventDetailsLink-validation"></div>
                        <small>Optional - link to registration page, more details, or event website</small>
                    </div>
                    <div class="form-group">
                        <label class="form-group__label">Event Image (Optional)</label>
                        <input type="file" class="form-group__input" id="eventImage" accept="image/*" onchange="handleEventImageUpload()">
                        <div class="image-preview" id="eventImagePreview" style="margin-top: 10px; display: none;">
                            <img style="width: 120px; height: 80px; object-fit: cover; border-radius: 4px; border: 2px solid #ddd;">
                            <button type="button" onclick="removeEventImage()" style="margin-left: 10px; padding: 5px 10px; background: #dc3545; color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer;">Remove</button>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button type="submit" class="btn btn--primary" style="flex: 1;">Add Event</button>
                        <button type="button" class="btn btn--secondary" onclick="modalManager.close('addEventModal')">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Main Content -->
        <section class="main-content">
            <div class="content-container">
                <div class="dashboard-container">
                    <!-- Sidebar -->
                    <div class="sidebar">
                        <div class="app-header">
                            <h1>Newsletter Builder Pro</h1>
                            <p class="subtitle">Enhanced Real Estate Marketing</p>
                            <div class="edition-badge">
                                <strong id="currentMonth">August 2025 Edition</strong><br>
                                <small>üöÄ Production Ready</small>
                            </div>
                        </div>
                        
                        <div class="form-content">
                            <!-- Newsletter Form -->
                            <div class="form-section fade-in">
                                <h3 class="form-section__header">üìù Personal Message</h3>
                                <div class="form-group">
                                    <label class="form-group__label required-field">Opening Message</label>
                                    <textarea class="form-group__textarea" id="personalMessage" rows="4" required>Before fall routines kick in, August is the perfect time to make a move or prep your home for sale. Let's chat about your next step!</textarea>
                                    <div class="validation-message" id="personalMessage-validation"></div>
                                    <small>Minimum 50 characters, maximum 1500 characters</small>
                                </div>
                            </div>

                            <div class="form-section fade-in">
                                <h3 class="form-section__header">üë§ Your Information</h3>
                                <div class="form-group">
                                    <label class="form-group__label required-field">Full Name</label>
                                    <input type="text" class="form-group__input" id="agentName" value="" required>
                                    <div class="validation-message" id="agentName-validation"></div>
                                </div>
                                <div class="form-group">
                                    <label class="form-group__label required-field">Company Name</label>
                                    <input type="text" class="form-group__input" id="companyName" value="" required>
                                    <div class="validation-message" id="companyName-validation"></div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label class="form-group__label required-field">Phone</label>
                                        <input type="tel" class="form-group__input" id="agentPhone" value="" required>
                                        <div class="validation-message" id="agentPhone-validation"></div>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-group__label required-field">Email</label>
                                        <input type="email" class="form-group__input" id="agentEmail" value="" required>
                                        <div class="validation-message" id="agentEmail-validation"></div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-group__label required-field">Website</label>
                                    <input type="url" class="form-group__input" id="agentWebsite" value="" required>
                                    <div class="validation-message" id="agentWebsite-validation"></div>
                                </div>
                            </div>
                            
                            <button class="btn btn--primary btn--full" onclick="generateNewsletter()" style="font-size: 16px; padding: 16px 24px;">
                                ‚ú® Generate Newsletter
                            </button>
                        </div>
                    </div>

                    <!-- Preview Container -->
                    <div class="preview-container">
                        <div class="preview-header">
                            <button onclick="toggleInstructionsPopup()" class="btn btn--primary" style="font-size: 14px; padding: 12px 24px;">
                                üìñ Quick User Guide
                            </button>
                            
                            <!-- Instructions Popup -->
                            <div id="instructionsPopup" style="display: none; margin-top: 20px; padding: 20px; background: white; border: 2px solid var(--primary-color); border-radius: 12px; text-align: left; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
                                <h3 style="color: var(--primary-color); margin-bottom: 15px; font-size: 18px;">üöÄ Quick Start Guide</h3>
                                
                                <div style="margin-bottom: 20px;">
                                    <h4 style="color: var(--text-light); font-size: 14px; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                        <span style="background: var(--primary-color); color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">1</span>
                                        Add Your Personal Message
                                    </h4>
                                    <p style="margin: 0 0 0 32px; font-size: 13px; color: var(--text-muted); line-height: 1.4;">Write your opening message to connect with your clients.</p>
                                </div>
                                
                                <div style="margin-bottom: 20px;">
                                    <h4 style="color: var(--text-light); font-size: 14px; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                        <span style="background: var(--primary-color); color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">2</span>
                                        Fill In Your Contact Information
                                    </h4>
                                    <p style="margin: 0 0 0 32px; font-size: 13px; color: var(--text-muted); line-height: 1.4;">Add your name, company, phone, email, and website.</p>
                                </div>
                                
                                <div style="margin-bottom: 20px;">
                                    <h4 style="color: var(--text-light); font-size: 14px; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                                        <span style="background: var(--primary-color); color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold;">3</span>
                                        Generate & Export
                                    </h4>
                                    <p style="margin: 0 0 0 32px; font-size: 13px; color: var(--text-muted); line-height: 1.4;">Click "Generate Newsletter" to see your preview, then use "Export Options" to copy for email, download HTML, or print.</p>
                                </div>
                                
                                <div style="text-align: center; margin-top: 15px;">
                                    <button onclick="toggleInstructionsPopup()" style="background: var(--primary-color); color: white; border: none; border-radius: 6px; padding: 10px 20px; cursor: pointer; font-size: 13px; font-weight: 500;">
                                        Got it! üëç
                                    </button>
                                </div>
                            </div>
                            
                            <p style="color: var(--text-muted); margin-top: 15px; font-size: 14px;">
                                <span id="previewStatus">üìù Start filling out the form to see your newsletter preview</span>
                            </p>
                        </div>
                        
                        <div class="newsletter-preview" id="newsletterPreview">
                            <!-- Newsletter content will be generated here -->
                        </div>
                        
                        <div class="preview-actions" style="padding-bottom: 20px;">
                            <button class="btn btn--primary" onclick="modalManager.show('exportModal')" style="font-size: 14px; padding: 12px 24px;">
                                üìß Export Options
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div> <!-- End newsletter wrapper -->

    <!-- Website scripts (parent directory) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <script src="../navigation.js"></script>

    <!-- Newsletter JavaScript (isolated) -->
    <script>
    (function() {
        'use strict';
        
        // Check if we're in newsletter section
        if (!document.querySelector('.newsletter-builder-wrapper')) return;
        
        // Global state
        let newsletterData = {
            agent: {
                name: '',
                company: '',
                phone: '',
                email: '',
                website: ''
            },
            content: {
                personalMessage: 'Before fall routines kick in, August is the perfect time to make a move or prep your home for sale. Let\'s chat about your next step!'
            },
            maintenanceTips: [
                'üè† Review roof for hail damage',
                'üî• Prep furnace for fall (early servicing)', 
                'üßπ Deep clean garage or shed',
                'üìã Plan fall landscaping or repairs',
                'üé® Touch up exterior paint'
            ]
        };

        // Modal manager for newsletter (uses new class names)
        const modalManager = {
            show: (modalId) => {
                const modal = document.getElementById(modalId);
                if (modal) modal.classList.add('newsletter-modal--show');
            },
            close: (modalId) => {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.classList.remove('newsletter-modal--show');
                    const form = modal.querySelector('form');
                    if (form) {
                        form.reset();
                    }
                }
            }
        };

        // Toast system
        function showToast(message, type = 'info', duration = 3000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast--${type}`;
            toast.textContent = message;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        // Basic functions to make the newsletter work
        function generateNewsletter() {
            updatePreview();
            showToast('‚ú® Newsletter generated successfully!', 'success');
        }

        function updatePreview() {
            const preview = document.getElementById('newsletterPreview');
            if (preview) {
                preview.innerHTML = `
                    <div style="max-width: 650px; margin: 0 auto; background: white; font-family: 'Montserrat', sans-serif; color: #333; padding: 40px; text-align: center;">
                        <h1 style="font-family: 'Playfair Display', serif; font-size: 36px; color: #f39c12; margin-bottom: 20px;">AUGUST NEWSLETTER</h1>
                        <div style="background: #f8f9fa; padding: 25px; border-left: 4px solid #f39c12; border-radius: 8px; margin: 30px 0;">
                            <p style="font-size: 16px; line-height: 1.8; font-style: italic;">${newsletterData.content.personalMessage}</p>
                        </div>
                        <div style="margin: 40px 0;">
                            <h2>Market Statistics</h2>
                            <p>Your market data will appear here when you add statistics.</p>
                        </div>
                        <div style="margin: 40px 0;">
                            <h2>Maintenance Tips</h2>
                            <ul style="text-align: left; max-width: 400px; margin: 0 auto;">
                                ${newsletterData.maintenanceTips.map(tip => `<li style="padding: 5px 0;">${tip}</li>`).join('')}
                            </ul>
                        </div>
                        <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid #eee;">
                            <h3>${newsletterData.agent.name || 'Your Name'}</h3>
                            <p>${newsletterData.agent.company || 'Your Company'}</p>
                            <p>üì± ${newsletterData.agent.phone || '(000) 000-0000'}</p>
                            <p>‚úâÔ∏è ${newsletterData.agent.email || 'your@email.com'}</p>
                            <p><a href="http://${newsletterData.agent.website || 'www.yourwebsite.com'}" style="color: #f39c12;">${newsletterData.agent.website || 'www.yourwebsite.com'}</a></p>
                        </div>
                    </div>
                `;
            }
        }

        function toggleInstructionsPopup() {
            const popup = document.getElementById('instructionsPopup');
            if (popup) {
                const isVisible = popup.style.display !== 'none';
                popup.style.display = isVisible ? 'none' : 'block';
            }
        }

        // Export manager
        const exportManager = {
            copyEmailSafeHTML: () => {
                const html = getEmailSafeHTML();
                navigator.clipboard.writeText(html).then(() => {
                    modalManager.close('exportModal');
                    showToast('‚úÖ Newsletter copied for email!', 'success', 6000);
                }).catch(() => {
                    showToast('‚ùå Failed to copy to clipboard', 'error');
                });
            },
            
            exportAsHTML: () => {
                const html = getEmailSafeHTML();
                const blob = new Blob([html], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'newsletter-august-2025-email-safe.html';
                a.click();
                URL.revokeObjectURL(url);
                modalManager.close('exportModal');
                showToast('‚úÖ Newsletter exported!', 'success');
            },

            printNewsletter: () => {
                modalManager.close('exportModal');
                setTimeout(() => {
                    window.scrollTo(0, 0);
                    showToast('üñ®Ô∏è Opening print dialog...', 'info', 2000);
                    window.print();
                }, 300);
            }
        };

        function getEmailSafeHTML() {
            const preview = document.getElementById('newsletterPreview');
            return `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newsletter</title>
    <style>
        body { margin: 0; padding: 20px; background: #f5f5f5; font-family: Arial, sans-serif; }
    </style>
</head>
<body>
    ${preview.innerHTML}
</body>
</html>`;
        }

        // Event listeners
        function setupEventListeners() {
            const container = document.querySelector('.newsletter-builder-wrapper');
            
            // Form inputs
            container.addEventListener('input', function(e) {
                if (e.target.matches('input, select, textarea')) {
                    const id = e.target.id;
                    const value = e.target.value;
                    
                    // Update newsletter data based on input
                    if (id === 'personalMessage') {
                        newsletterData.content.personalMessage = value;
                        updatePreview();
                    } else if (id === 'agentName') {
                        newsletterData.agent.name = value;
                        updatePreview();
                    } else if (id === 'agentEmail') {
                        newsletterData.agent.email = value;
                        updatePreview();
                    } else if (id === 'agentPhone') {
                        newsletterData.agent.phone = value;
                        updatePreview();
                    } else if (id === 'companyName') {
                        newsletterData.agent.company = value;
                        updatePreview();
                    } else if (id === 'agentWebsite') {
                        newsletterData.agent.website = value.replace(/^https?:\/\//, ''); // Remove protocol
                        updatePreview();
                    }
                }
            });

            // Close modal when clicking outside
            container.addEventListener('click', function(e) {
                if (e.target.classList.contains('newsletter-modal-overlay')) {
                    const modalId = e.target.id;
                    modalManager.close(modalId);
                }
            });
        }

        // Initialize
        function init() {
            setupEventListeners();
            updatePreview();
            showToast('Newsletter Builder loaded successfully!', 'success', 3000);
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

    })(); // End newsletter isolation
    </script>
</body>
</html>
